<html>

<head>
    <script src="https://d3js.org/d3.v5.min.js"></script>

</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        var crs = { "courses": [{ "depart": "CS", "id": "192", "name": "CgxCskqegsWphGSehcjz", "desc": "JSnjEUSgMPRhocQuiljtIBeWyCeZqxTRbOrT DHXMIgRQVDj BlR", "cred": 4, "p": true, "pre": ["CS 162", "CS 163", "CS 202"] }, { "depart": "CS", "id": "162", "name": "zQCPWjAKsEyTtidseINU", "desc": "mOdfpKuqWr dfRCdByPNLQqlvLXMZCFAPVwplfxfglSPzdaNSdQQy", "cred": 4, "p": false, "pre": ["MTH 200"] }, { "depart": "MTH", "id": "200", "name": "CgxCskqegshcjz", "desc": "CeZqxTRbOrT DHXMIgRQVDj BlR", "cred": 4, "p": false, "pre": [] }] }
        let entries = [];
        let names = [];

        for (let i = 0; i < crs.courses.length; i++) {
            let entry = new Object();
            entry.depart = crs.courses[i].depart;
            entry.id = crs.courses[i].id;
            entry.name = crs.courses[i].name;
            entry.desc = crs.courses[i].desc;
            entry.cred = crs.courses[i].cred;
            entry.p = crs.courses[i].p;
            entry.pre = crs.courses[i].pre;
            entry.info = crs.courses[i].depart + " " + crs.courses[i].id;

            entry.x = Math.floor(Math.random() * 200);
            entry.y = Math.floor(Math.random() * 200);
            entry.selected = false;
            entry.highlighted = false;
            entries.push(entry);
            names.push(entry.depart + " " + entry.id);
        }

        let graph = d3.select("body").append("svg").attr("viewBox", "0 0 500 500");

        function getColor(i) {
            if (!(i > (entries.length - 1))) {
                if (entries[i].depart === "CS") {
                    if (entries[i].highlighted === true) {
                        return "GreenYellow";
                    } else {
                        return "Green";
                    }
                } else {
                    if (entries[i].highlighted === true) {
                        return "Cyan";
                    } else {
                        return "Blue";
                    }
                }
            }
        }

        function getSize(i) {
            if (!(i > (entries.length - 1))) {
                if (entries[i].selected === true) {
                    return 10;
                } else {
                    return 5;
                }
            }
        }

        function selectCircle() {
            let found = false;
            let sel = entries[0];
            for (let i = 0; i < entries.length; i++) {
                if (this.id === entries[i].info) {
                    found = true;
                    sel = entries[i];
                } else {
                    entries[i].selected = false;
                    entries[i].highlighted = false;
                }
            }

            if (found === true) {
                console.log("change");
                if (sel.selected === false) {
                    sel.selected = true;
                    sel.highlighted = true;
                    for (let i = 0; i < entries.length; i++) {
                        for (let k = 0; k < entries.length; k++) {
                            let name = entries[k].depart + " " + entries[k].id;
                            if (sel.pre.includes(name)) {
                                entries[k].highlighted = true;
                            } else {
                                highlighted = false;
                            }

                        }
                    }
                } else {
                    sel.selected = false;
                    sel.highlighted = false;
                    for (let i = 0; i < entries.length; i++) {
                        for (let k = 0; k < entries.length; k++) {
                            let name = entries[k].depart + " " + entries[k].id;
                            if (sel.pre.includes(name)) {
                                entries[k].highlighted = false;
                            } else {
                                highlighted = false;
                            }

                        }
                    }
                }

                draw();
            }

        }

        function draw() {
            graph.selectAll("*").remove();

            //draw lines
            //arrows will seem to rquire the use of svg polygons. calculating them will probably be a little complex and I'd rather finalize how
            //we will calculate the positions of everything else before we figure that out

            for (let i = 0; i < entries.length; i++) {
                let me = entries[i];
                let name = me.depart + " " + me.id;


                for (let k = 0; k < entries.length; k++) {
                    let name = entries[k].depart + " " + entries[k].id;
                    if (me.pre.includes(name)) {
                        graph.append("line").attr("x1", me.x).attr("x2", entries[k].x).attr("y1", me.y).attr("y2", entries[k].y).attr("stroke", "black").attr("stroke-width", ".5");
                    }

                }
            }

            //draw circles
            for (let i = 0; i < entries.length; i++) {
                graph.append("circle").attr("cx", entries[i].x).attr("cy", entries[i].y).attr("r", getSize(i)).attr("fill", getColor(i)).attr("id", entries[i].depart + " " + entries[i].id).on("click", selectCircle);
                if (entries[i].selected === false) {
                    graph.append("text").attr("x", (entries[i].x) - 5).attr("y", entries[i].y).attr("style", "font-size: 3").text(entries[i].depart + " " + entries[i].id);
                } else {
                    graph.append("text").attr("x", (entries[i].x) - 5).attr("y", entries[i].y).attr("style", "font-size: 3").text(entries[i].depart + " " + entries[i].id + ": " + entries[i].desc);
                }
            }

        }


        //can be changed to when data arrives
        $(document).ready(function () {
            draw();
        });


    </script>

</body>

</html>